<form [formGroup]="form">
    <div class="page_header d-flex align-items-center justify-content-between mb-10">
        <h2 class="header_title" *ngIf="!orderId">New Order</h2>
        <h2 class="header_title" *ngIf="orderId">Edit Order : {{orderId}}</h2>

        <div class="order_timeBox ml-auto">
            <p><span>From:</span> {{orderData?.bearer.firstName}} {{orderData?.bearer.lastName}} <span class="ml-15">At: </span> {{orderData?.created_at | datex:'DD-MM-YYYY hh:mm a'}}</p>
        </div>

        <div *ngIf="orderData?.rejectedCount > 0 && orderData?.orderStatus == 'new'" class="status_box red">
            Items Rejected
        </div>
        <div *ngIf="orderData?.rejectedCount <= 0 && (orderData?.timeDif.h * 60 + orderData?.timeDif.i) > 20 && orderData?.orderStatus == 'new'" class="status_box red">
            Got Delayed
        </div>
        <div *ngIf="orderData?.rejectedCount <= 0 && (orderData?.timeDif.h * 60 + orderData?.timeDif.i) <= 20 && orderData?.orderStatus == 'new'" class="status_box warn">
            On Going
        </div>
        <div *ngIf="orderData?.orderStatus == 'cancelled'" class="status_box red">
            Cancelled
        </div>
        <div *ngIf="orderData?.orderStatus == 'completed'" class="status_box">
            Completed
        </div>
    </div>

    <div class="d-flex mb-20">
        <mat-form-field appearance="outline" class="pb-0 mr-10" *ngIf="userData?.roles == 'Super Admin'">
            <mat-label>Branch</mat-label>
            <mat-select matNativeControl formControlName="branch_id"  [required]="userData?.roles == 'Super Admin'">
                <mat-option *ngFor="let item of branchList;" [value]="item.id">{{ item.branchTitle }}</mat-option>
            </mat-select>
        </mat-form-field>
        <mat-chip-list aria-label="Fish selection">
            <ng-container *ngFor="let item of orderTypeList;">
                <mat-chip *ngIf="item.isActive" color="primary" [selected]="item.id == form.get('orderType').value" (click)="changeOrderType(item.id, 'button')">{{ item.orderType }}</mat-chip>
            </ng-container>
          </mat-chip-list>
          <div class="ml-auto" *ngIf="selectedOrderType?.tableRequired">
              <button mat-button color="primary" type="button" (click)="manageTables()">
                  <mat-icon>view_module</mat-icon>
                  Tables
              </button>
          </div>
    </div>
    
    <div class="order_layout scroll_style">
        <div class="customer_section">
            <h2 class="header_title">Customer Details</h2>
            <div class="row">
                <div class="col">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Related Info</mat-label>
                        <input formControlName="relatedInfo" matInput>
                    </mat-form-field>
                </div>
                <div class="col">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Customer Name</mat-label>
                        <input formControlName="customerName" matInput>
                    </mat-form-field>
                </div>
                <div class="col">
                    <mat-form-field appearance="outline" class="w-100">
                        <mat-label>Mobile Number</mat-label>
                        <input formControlName="mobileNumber" matInput>
                    </mat-form-field>
                </div>
            </div>
        </div>
        <div class="billing_details">
            <div class="delivery_box">
                <mat-form-field appearance="outline" class="w-100 inline-input">
                    <mat-label>Deliver Charge (Optional)</mat-label>
                    <input matInput  [formControl]="form.get('deliverCharge')" (change)="handleFinalPricing()" digitOnly [decimal]="true">
                </mat-form-field>
            </div>
            <div class="billing_wrapper">
                <div class="billing_strip">
                    <p class="title">Order Item Total</p>
                    <span class="value_section">{{ form.get('orderItemTotal').value | currency }}</span>
                </div>
                <div class="billing_strip">
                    <p class="title">Delivery Charge</p>
                    <span class="value_section">{{ form.get('deliverCharge').value | currency }}</span>
                </div>
                <div class="billing_strip" *ngIf="form.get('packingCharge').value">
                    <p class="title">Total Pkg Charge</p>
                    <span class="value_section">{{ form.get('packingCharge').value | currency }}</span>
                </div>
                
                <div class="billing_strip" *ngIf="!form.get('taxDisabled').value">
                    <p class="title">CGST <small class="text-muted">({{ ((form.get('taxPercent').value > 0)?(form.get('taxPercent').value/2):0) | number : '2.2' }}%)</small></p>
                    <span class="value_section">{{ form.get('cgst').value | currency }}</span>
                </div>
                <div class="billing_strip" *ngIf="!form.get('taxDisabled').value">
                    <p class="title">SGST <small class="text-muted">({{ ((form.get('taxPercent').value > 0)?(form.get('taxPercent').value/2):0) | number : '2.2' }}%)</small></p>
                    <span class="value_section">{{ form.get('sgst').value | currency }}</span>
                </div>
                <div class="billing_strip">
                    <p class="title">Grand Total</p>
                    <span class="value_section">{{ form.get('orderAmount').value | currency }}</span>
                </div>

                <hr>
                <mat-form-field appearance="outline" class="w-100 inline-input order-calc" *ngIf="!blockForms">
                    <mat-label>Received</mat-label>
                    <input matInput  #calcAmount digitOnly [decimal]="true">
                    <span matSuffix *ngIf="calcAmount.value">
                        <small>Return</small><br>
                        {{ calcAmount.value - form.get('orderAmount').value  }}
                    </span>
                </mat-form-field>
                <div class="text-center">
                    <button mat-stroked-button color="primary" class="my-10 ew-mn-120 mx-auto" 
                        *ngIf="form.get('orderStatus').value != 'completed' && form.get('orderStatus').value != 'cancelled' && !blockForms"  
                        (click)="saveOrder('confirm')">Save</button>
                        
                </div>

            </div>
            <div class="action_wrapper">
                <button mat-raised-button color="success" class="w-100 rounded-0" type="button"
                    *ngIf="form.get('orderStatus').value != 'completed' && form.get('orderStatus').value != 'cancelled' && !blockForms"  
                    (click)="saveOrder('complete')">Complete</button>


                <button mat-raised-button color="accent" *ngIf="form.get('orderStatus').value == 'completed'" class="w-100 rounded-0" (click)="printOrder()"><mat-icon>print</mat-icon> Print</button>

                <button mat-raised-button color="warn" 
                    *ngIf="orderId && form.get('orderStatus').value != 'completed' && form.get('orderStatus').value != 'cancelled' && !blockForms" 
                    class="w-100 rounded-0" (click)="saveOrder('cancel')">Cancel</button>
            </div>
        </div>
        <div class="order_items">
            <div class="page_header d-flex mb-4">
                <h2 class="header_title">Items</h2>
                <div class="ml-auto">
                    <button mat-button color="accent" type="button" *ngIf="items['controls'].length > 0 && !blockForms" (click)="serveOrderItem()">
                        <mat-icon>done_all</mat-icon>
                        Serve Items
                    </button>
                    <button mat-button color="primary" *ngIf="!blockForms" type="button" (click)="addNewOrderItem()">
                        <mat-icon>add</mat-icon>
                        Add Item
                    </button>
                </div>
            </div>
            <ng-container *ngFor="let item of items['controls'];let i=index;">
                <div class="row no-gutters order_item_wrapper">
                    <div class="col-auto">
                        <div class="img_item">
                            <img *ngIf="item.get('featuredImage').value" [src]=" url + item.get('featuredImage').value" alt="">
                            <img *ngIf="!item.get('featuredImage').value" src="/assets/images/food.jpg" alt="">
                        </div>
                    </div>
                    <div class="col">
                        <div class="order_item_card" *ngIf="!item.get('deletedFlag').value">
                            <div class="order-details col">
                                <p class="product_name">{{ item.get('productName').value }} <span class="order_item_card_strip" *ngIf="item.get('isParcel').value">Parcel</span></p>
                                <p class="product_price">
                                    <small>Price: &nbsp;&nbsp;&nbsp;</small>
                                    <span>{{ item.get('price').value | currency  }}</span>
                                </p>
                                <p class="product_price" *ngIf="item.get('isParcel').value">
                                    <small>Packaging charges: &nbsp;&nbsp;&nbsp;</small>
                                    <span>{{ item.get('packagingCharges').value | currency  }}</span>
                                </p>
                                <p class="product_price">
                                    <small>Total: &nbsp;&nbsp;&nbsp;</small>
                                    <span>{{ item.get('totalPrice').value | currency }}</span>
                                </p>
                                <button type="button" mat-stroked-button color="warn" class="mt-15" *ngIf="item.get('productionRejectedQuantity').value > 0" (click)="handleRejectedItems(item)">Remove Rejected</button>
                            </div>
                            <div class="action_menu col-auto">
                                <div class="input-group mb-0 ml-auto number_input">
                                    <div class="input-group-prepend">
                                        <button class="btn btn-outline-secondary" type="button" (click)="handleNumberControl(item, 'prev', i)">-</button>
                                    </div>
                                    <input type="text" class="form-control" [formControl]="item.get('quantity')" (keyup)="handleNumberControl(item, 'text', i)" digitOnly>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button" (click)="handleNumberControl(item, 'next', i)">+</button>
                                    </div>
                                </div>
                                <div class="d-flex mt-15">
                                    <p class="text-success px-2 mb-0">Served: <b>{{ item.get('servedItems').value }}</b></p>
                                    <p class="text-accent px-2 mb-0">Kitchen: <b>{{ item.get('quantity').value - item.get('servedItems').value - item.get('productionRejectedQuantity').value}}</b></p>
                                    <p class="text-danger pl-2 mb-0">Rejected: <b>{{ item.get('productionRejectedQuantity').value }}</b></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </ng-container>
        </div>
    </div>


<!-- new design -->

<div class="row no-gutterd order_out_wrapper">
    <div class="col-md-auto col-12 px-0">
        <div class="left_bar">
            <div class="left_header">
                <h2>Order Id: {{orderId ? orderId : '--'}}</h2>
                <div class="order_timeBox ml-auto">
                    <p><span>From:</span> {{orderData?.bearer.firstName}} {{orderData?.bearer.lastName}} <span class="ml-15">At: </span> {{orderData?.created_at | datex:'DD-MM-YYYY hh:mm a'}}</p>
                </div>
            </div>
            <h3 class="left_title">Categories</h3>
            <ul class="list-unstyled mb-0 category_list">
                <li class="active"><div class="product_img" style="background-image: url('/assets/images/food.jpg');"></div><span>All</span></li>
                <li><div class="product_img" style="background-image: url('/assets/images/food.jpg');"></div><span>Veg</span></li>
                <li><div class="product_img" style="background-image: url('/assets/images/food.jpg');"></div><span>Nonveg</span></li>
                <li><div class="product_img" style="background-image: url('/assets/images/food.jpg');"></div><span>Starter</span></li>
                <li><div class="product_img" style="background-image: url('/assets/images/food.jpg');"></div><span>Juices</span></li>
            </ul>
        </div>
    </div>
    <div class="col-md col-12">
        <div class="top_flterBar d-flex align-items-center flex-wrap">
            <div>
                <mat-chip-list aria-label="Fish selection">
                    <ng-container *ngFor="let item of orderTypeList;">
                        <mat-chip *ngIf="item.isActive" color="primary" [selected]="item.id == form.get('orderType').value" (click)="changeOrderType(item.id, 'button')">{{ item.orderType }}</mat-chip>
                    </ng-container>
                  </mat-chip-list>
            </div>

            <div *ngIf="orderData?.rejectedCount > 0 && orderData?.orderStatus == 'new'" class="status_box ml-auto red">
                Items Rejected
            </div>
            <div *ngIf="orderData?.rejectedCount <= 0 && (orderData?.timeDif.h * 60 + orderData?.timeDif.i) > 20 && orderData?.orderStatus == 'new'" class="status_box ml-auto red">
                Got Delayed
            </div>
            <div *ngIf="orderData?.rejectedCount <= 0 && (orderData?.timeDif.h * 60 + orderData?.timeDif.i) <= 20 && orderData?.orderStatus == 'new'" class="status_box ml-auto warn">
                On Going
            </div>
            <div *ngIf="orderData?.orderStatus == 'cancelled'" class="status_box ml-auto red">
                Cancelled
            </div>
            <div *ngIf="orderData?.orderStatus == 'completed'" class="status_box ml-auto">
                Completed
            </div>
        </div>
        <div class="row">
            <div class="col-md-6 col-12">
                <div class="product_lists">
                    <h2 class="productHeading">Products</h2>
                    <ul class="list-unstyled mb-0">
                        <li class="itemTitle">Starters</li>
                        <li class="product_items d-flex">
                            <div class="produt_img"></div>
                            <div class="textbox">
                                <p>Gobi</p>
                                <span>&#8377; 12.00</span>
                            </div>
                            <div class="buttonBox">
                                <div class="input-group mb-0 ml-auto number_input">
                                    <div class="input-group-prepend">
                                        <button class="btn btn-outline-secondary" type="button">-</button>
                                    </div>
                                    <input type="text" class="form-control" digitOnly>
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary" type="button">+</button>
                                    </div>
                                </div>
                                <mat-slide-toggle color="primary">Parcel?</mat-slide-toggle>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-md-6 col-12">
                <div class="right_details_box">
                    <mat-tab-group>
                        <mat-tab>
                            <ng-template mat-tab-label>
                                <mat-icon class="example-tab-icon">thumb_up</mat-icon>
                                Items
                            </ng-template>

                            items

                        </mat-tab>
                        <mat-tab>
                            <ng-template mat-tab-label>
                                <mat-icon class="example-tab-icon">thumb_up</mat-icon>
                                Table
                            </ng-template>
                            table
                        </mat-tab>
                        <mat-tab>
                            <ng-template mat-tab-label>
                                <mat-icon class="example-tab-icon">thumb_up</mat-icon>
                                Customer
                            </ng-template>
                            customer
                        </mat-tab>
                        <mat-tab>
                            <ng-template mat-tab-label>
                                <mat-icon class="example-tab-icon">thumb_up</mat-icon>
                                Bill
                            </ng-template>
                            Bill
                        </mat-tab>
                      </mat-tab-group>
                </div>
            </div>
        </div>
    </div>
</div>

</form>